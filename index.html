<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>七夕快乐</title>
  <style>
    :root{--bg1:#0b1026;--bg2:#16223f;--text:#fff;--accent:#ff7aa2;}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;overflow:hidden;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Noto Sans CJK SC;color:var(--text)}
    body{background:linear-gradient(180deg,var(--bg1),var(--bg2))}
    .stars{position:absolute;inset:0;height:38vh;pointer-events:none;z-index:1;
      background-image:
        radial-gradient(1.4px 1.4px at 22% 30%, rgba(255,255,255,.6), rgba(255,255,255,0)),
        radial-gradient(1.2px 1.2px at 70% 22%, rgba(255,255,255,.5), rgba(255,255,255,0));
      opacity:.5;animation:twinkle 18s ease-in-out infinite;}
    @keyframes twinkle{0%{opacity:.5}50%{opacity:.6}100%{opacity:.5}}
    canvas.layer{position:fixed;inset:0;width:100%;height:100%;display:block}
    #bg{z-index:2} #mid{z-index:3} #fg{z-index:4}
    #barrage{position:fixed;inset:0;overflow:hidden;pointer-events:none;z-index:5}
    .b-item{position:absolute;white-space:nowrap;font-size:14px;padding:6px 10px;border-radius:999px;color:#fff;
      background:rgba(255,122,162,.10);border:1px solid rgba(255,255,255,.10);
      text-shadow:0 1px 8px rgba(0,0,0,.22);box-shadow:0 2px 8px rgba(0,0,0,.18);
      transform:translateX(100vw);transition:transform 22s linear,opacity .8s ease;}
    .hero{position:absolute;inset:0;display:grid;place-content:center;text-align:center;z-index:6;pointer-events:none;padding:16px}
    h1{margin:0 0 8px 0;font-size:clamp(36px,8vw,88px);line-height:1.05;letter-spacing:2px;
      background:linear-gradient(90deg,#fff,var(--accent),#fff);-webkit-background-clip:text;background-clip:text;color:transparent;}
    .subtitle{font-size:clamp(14px,2.6vw,22px);opacity:.9}
    .badge{position:fixed;right:12px;bottom:10px;font-size:12px;opacity:.75;background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:6px 10px;z-index:6}
  </style>
</head>
<body>
  <div class="stars"></div>
  <canvas id="bg" class="layer"></canvas>
  <canvas id="mid" class="layer"></canvas>
  <canvas id="fg" class="layer"></canvas>
  <div id="barrage" aria-hidden="true"></div>
  <div class="hero" aria-hidden="true">
    <h1>七夕快乐</h1>
    <div class="subtitle">愿有岁月可回首，且以深情共白头 ❤</div>
  </div>
  <div class="badge">轻触屏幕，会有少量爱心绽放</div>

  <script>
  (()=>{
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    const layers = ["bg","mid","fg"].map(id=>{const c=document.getElementById(id);const ctx=c.getContext('2d');return {c,ctx,hearts:[],id}});
    function resize(){
      const {innerWidth:w,innerHeight:h}=window;
      layers.forEach(({c,ctx})=>{c.width=Math.floor(w*DPR);c.height=Math.floor(h*DPR);c.style.width=w+'px';c.style.height=h+'px';ctx.setTransform(DPR,0,0,DPR,0,0)});
    }
    resize(); window.addEventListener('resize',resize,{passive:true});
    const PALETTE=['#ff5f8f','#ff3d7f','#ff77a9','#ff9eb5','#ffd1dc','#ffd166'];
    const rnd=(a,b)=>a+Math.random()*(b-a); const pick=a=>a[(Math.random()*a.length)|0];

    class Heart{
      constructor(layer,w,h){this.layer=layer;this.reset(w,h,true)}
      reset(w,h,randomY=false){
        const depth=this.layer===0?0.5:this.layer===1?1:1.4;
        this.x=Math.random()*w; this.y=randomY?Math.random()*h:-rnd(20,80);
        this.sizeBase=rnd(6,this.layer===2?22:16); this.size=this.sizeBase;
        this.vy=rnd(3,7)*depth; this.vx=rnd(-2,2)*depth; // 明显更慢
        this.rot=rnd(0,Math.PI); this.vr=rnd(-0.35,0.35)*depth;
        this.color=pick(PALETTE); this.alpha=rnd(0.78,0.9); this.life=0;
        this.pulse=rnd(0.004,0.008); this.sway=rnd(0.006,0.010);
        this.blur=this.layer===2?1:0; // 几乎不发光
      }
      update(dt,w,h){
        // 极轻微的脉动，无闪烁
        const scale = 1 + Math.sin(this.life*this.pulse)*0.03;
        this.size = this.sizeBase * scale;
        this.x += this.vx*dt + Math.sin(this.life*this.sway)*0.25*(this.sizeBase/16);
        this.y += this.vy*dt; this.rot += this.vr*dt; this.life += dt;
        this.alpha = 0.75 + Math.sin(this.life*0.01)*0.02;
        if(this.y - this.size > h + 40) this.reset(w,h,false);
      }
      draw(ctx){
        ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.rot);
        const s=this.size; ctx.scale(s,s);
        ctx.beginPath();
        ctx.moveTo(0,-0.45);
        ctx.bezierCurveTo(-0.26,-0.95,-0.95,-0.96,-1.08,-0.28);
        ctx.bezierCurveTo(-1.32,0.58,-0.5,1.02,0,1.24);
        ctx.bezierCurveTo(0.5,1.02,1.32,0.58,1.08,-0.28);
        ctx.bezierCurveTo(0.95,-0.96,0.26,-0.95,0,-0.45);
        ctx.closePath();
        ctx.globalAlpha = this.alpha; // 取消 alpha 波动
        ctx.fillStyle=this.color; ctx.shadowColor=this.color; ctx.shadowBlur=this.blur; ctx.fill();
        ctx.restore();
      }
    }

    function seed(){
      const w=layers[0].c.width/DPR, h=layers[0].c.height/DPR;
      [22,26,14].forEach((count,idx)=>{for(let i=0;i<count;i++){layers[idx].hearts.push(new Heart(idx,w,h))}});
    }
    seed();

    function burst(x,y){
      const w=layers[0].c.width/DPR; const N=10; // 少量喷射
      for(let i=0;i<N;i++){
        const idx = i%3, angle=Math.random()*Math.PI*2, speed=rnd(16,32)*(idx===2?1.1:1);
        const hrt=new Heart(idx,w,0); hrt.x=x; hrt.y=y;
        hrt.vy=Math.sin(angle)*speed + 8; hrt.vx=Math.cos(angle)*speed*0.5;
        hrt.sizeBase=rnd(10,18); hrt.color=pick(PALETTE);
        layers[idx].hearts.push(hrt);
      }
      setTimeout(()=>{layers.forEach(L=>{if(L.hearts.length>60)L.hearts.splice(60)})},2000);
    }
    function pointer(e){const t=e.touches?e.touches[0]:e; const rect=layers[0].c.getBoundingClientRect(); burst(t.clientX-rect.left,t.clientY-rect.top)}
    addEventListener('click',pointer); addEventListener('touchstart',pointer,{passive:true});

    let last=performance.now();
    function loop(now){
      const dt=Math.min(60,now-last)/1000*60; last=now;
      layers.forEach(L=>{
        const w=L.c.width/DPR, h=L.c.height/DPR;
        L.ctx.clearRect(0,0,w,h); // 直接清屏，最干净稳定
        for(let i=0;i<L.hearts.length;i++){L.hearts[i].update(dt,w,h); L.hearts[i].draw(L.ctx)}
      });
      requestAnimationFrame(loop);
    }
    layers.forEach(L=>L.ctx.clearRect(0,0,L.c.width,L.c.height));
    requestAnimationFrame(loop);

    const barrage=document.getElementById('barrage');
    const SENTENCES=[
      "愿有岁月可回首，且以深情共白头",
      "执子之手，与子偕老",
      "今夕何夕，见此良人",
      "人间值得，所幸有你",
      "情不知所起，一往而深",
      "与你共赴，山海皆可平",
      "星河滚烫，你是人间理想",
      "良辰美景，与你同赏",
      "见山是你，见海是你",
      "在所有不见的风景里，我最想见你",
      "与你相遇，三生有幸",
      "我想和你一起看尽人间烟火",
      "心中有你，便是良辰美景",
      "有你在的地方，就是家",
      "七夕快乐，爱你永远",
      "山河远阔，人间烟火，你是我唯一的心动",
      "陪你看日出，伴你到黄昏",
      "我的心为你而跳动",
      "岁岁年年，朝朝暮暮",
      "我愿意，千山万水只为你",
      "牵你的手，走到白头",
      "爱你，是我此生不变的誓言",
      "月色真美，不及你笑颜",
      "七夕有你，星河都浪漫",
      "你的名字，是我心中最美的诗"
    ];
    function launch(){
      const div=document.createElement('div'); div.className='b-item';
      div.textContent=SENTENCES[(Math.random()*SENTENCES.length)|0];
      const top=Math.random()*(innerHeight*0.68)+innerHeight*0.16;
      div.style.top=top+'px'; barrage.appendChild(div);
      requestAnimationFrame(()=>{div.style.transform='translateX(-120vw)'});
      setTimeout(()=>{div.style.opacity='0'; setTimeout(()=>div.remove(),900)},22000);
    }
    // 弹幕显著降频
    setInterval(launch, 2600); for(let i=0;i<3;i++) launch();
  })();
  </script>
</body>
</html>